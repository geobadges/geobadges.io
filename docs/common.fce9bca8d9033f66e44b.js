(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{BDzq:function(e,t,i){"use strict";i.d(t,"a",function(){return n});var n=function(){function e(){}return e.stringMatches=function(t,i,n){return(t=e.normalizeString(t)).indexOf(i)>=0||!!n.exec(t)},e.normalizeString=function(e){return(e=(e=e||"").toLowerCase()).trim()},e.tryRegExp=function(e){try{return RegExp(e)}catch(t){return null}},e}()},hLjm:function(e,t,i){"use strict";function n(e,t){return e.getTime()===t.getTime()?0:e>t?1:e<t?-1:void 0}i.d(t,"a",function(){return n})},pPDD:function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i("mrSG"),r=i("RwuH"),a=(i("Lu01"),i("EK0e"),i("mQ+e"),i("2MDl"),i("BDzq")),o=function(e){function t(t,i,n,r,a,o){var s=e.call(this,t,i)||this;return s.badgeManager=n,s.recipientBadgeCollectionManager=r,s.messageService=a,s.settingsService=o,s.dialogId="recipientBadgeCollectionSelection",s.dialogTitle="Select Badges",s.badgeCollectionsResults=[],s.selectedCollections=[],s._searchQuery="",s}return n.d(t,e),Object.defineProperty(t.prototype,"searchQuery",{get:function(){return this._searchQuery},set:function(e){this._searchQuery=e,this.updateResults()},enumerable:!0,configurable:!0}),t.prototype.openDialog=function(e){var t=this,i=e.dialogTitle,n=e.omittedCollection;return this.dialogId=e.dialogId,this.dialogTitle=i,this.omittedCollection=n,this.selectedCollections=[],this._searchQuery="",this.showModal(),this.updateData(),new Promise(function(e,i){t.resolveFunc=e})},t.prototype.cancelDialog=function(){this.closeModal()},t.prototype.saveDialog=function(){this.closeModal(),this.resolveFunc(this.selectedCollections)},t.prototype.updateData=function(){var e=this;this.collectionListLoaded=this.recipientBadgeCollectionManager.recipientBadgeCollectionList.loadedPromise.then(function(t){e.badgeCollections=t.entities,e.updateResults()}).catch(function(t){return e.messageService.reportAndThrowError("Failed to load your badges",t)})},t.prototype.updateCollection=function(e,t){t?this.selectedCollections.push(e):this.selectedCollections=this.selectedCollections.filter(function(t){return t.name!==e.name})},t.prototype.applySorting=function(){(this.badgeCollectionsResults||[]).sort(function(e,t){var i=e.name.toLowerCase(),n=t.name.toLowerCase();return i===n?0:i<n?-1:1})},t.prototype.updateResults=function(){var e=this;this.badgeCollectionsResults.length=0,this.badgeCollections.filter(s.collectionMatcher(this.searchQuery)).forEach(function(t){e.omittedCollection.collections.has(t)||e.badgeCollectionsResults.push(t)}),this.applySorting()},t}(r.a),s=function(){function e(){}return e.collectionMatcher=function(e){var t=a.a.normalizeString(e),i=a.a.tryRegExp(t);return function(e){return a.a.stringMatches(e.name,t,i)}},e}()},yh5M:function(e,t,i){"use strict";i.d(t,"a",function(){return s}),i.d(t,"c",function(){return l}),i.d(t,"b",function(){return c});var n=i("mrSG"),r=(i("mQ+e"),i("6g7h"),i("L4FK")),a=(i("mKbH"),i("Lu01"),i("pPDD"),i("Hspw")),o=i("hLjm"),s=(i("Xfds"),i("DXuK"),i("oO6y"),i("e/WM"),function(e){function t(t,n,r,s,l,c,d,u,g,p,h){var f=e.call(this,t,n,r)||this;return f.recipientBadgeManager=s,f.title=l,f.messageService=c,f.eventService=d,f.dialogService=u,f.configService=g,f.externalToolsManager=p,f.queryParametersService=h,f.issuerImagePlacholderUrl=Object(a.c)(i("EgPM")),f.badgeLoadingImageUrl=i("7GEZ"),f.badgeFailedImageUrl=i("HYZ6"),f.badges=[],f.now=new Date,f.compareDate=o.a,f.tense={expires:{"=-1":"Expired","=0":"Expires","=1":"Expires"}},f.badgesLoaded=f.recipientBadgeManager.recipientBadgeList.loadedPromise.then(function(e){f.updateBadge(e),f.crumbs=[{title:"Backpack",routerLink:["/recipient/badges"]},{title:f.badge.badgeClass.name,routerLink:["/earned-badge/"+f.badge.slug]}]}).catch(function(e){return f.messageService.reportAndThrowError("Failed to load your badges",e)}),f.externalToolsManager.getToolLaunchpoints("earner_assertion_action").then(function(e){f.launchpoints=e}),f}return n.d(t,e),Object.defineProperty(t.prototype,"badgeSlug",{get:function(){return this.route.snapshot.params.badgeSlug},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recipientBadgeInstances",{get:function(){return this.recipientBadgeManager.recipientBadgeList},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){e.prototype.ngOnInit.call(this)},t.prototype.shareBadge=function(){this.dialogService.shareSocialDialog.openDialog(l(this.badge))},t.prototype.deleteBadge=function(e){var t=this;this.dialogService.confirmDialog.openResolveRejectDialog({dialogTitle:"Confirm Remove",dialogBody:"Are you sure you want to remove "+e.badgeClass.name+" from your badges?",rejectButtonLabel:"Cancel",resolveButtonLabel:"Remove Badge"}).then(function(){return t.recipientBadgeManager.deleteRecipientBadge(e).then(function(){t.messageService.reportMajorSuccess(e.badgeClass.name+" has been deleted",!0),t.router.navigate(["/recipient"])},function(i){t.messageService.reportHandledError("Failed to delete "+e.badgeClass.name,i)})},function(){})},Object.defineProperty(t.prototype,"rawJsonUrl",{get:function(){return this.configService.apiConfig.baseUrl+"/public/assertions/"+this.badgeSlug+".json"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rawBakedUrl",{get:function(){return this.configService.apiConfig.baseUrl+"/public/assertions/"+this.badgeSlug+"/baked"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"verifyUrl",{get:function(){var e,t,i=this.configService.assertionVerifyUrl+"?url="+this.rawJsonUrl;try{for(var r=n.j(["identity__email","identity__url","identity__telephone"]),a=r.next();!a.done;a=r.next()){var o=a.value,s=this.queryParametersService.queryStringValue(o);s&&(i=i+"&"+o+"="+s)}}catch(l){e={error:l}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return i},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isExpired",{get:function(){return this.badge&&this.badge.expiresDate&&this.badge.expiresDate<new Date},enumerable:!0,configurable:!0}),t.prototype.manageCollections=function(){var e=this;this.collectionSelectionDialog.openDialog({dialogId:"recipient-badge-collec",dialogTitle:"Add to Collection(s)",omittedCollection:this.badge}).then(function(t){e.badge.collections.addAll(t),e.badge.save().then(function(t){return e.messageService.reportMinorSuccess("Collection "+e.badge.badgeClass.name+" badges saved successfully")}).catch(function(t){return e.messageService.reportHandledError("Failed to save Collection",t)})})},t.prototype.removeCollection=function(e){var t=this;this.badge.collections.remove(e),this.badge.save().then(function(e){return t.messageService.reportMinorSuccess("Collection removed successfully from "+t.badge.badgeClass.name)}).catch(function(e){return t.messageService.reportHandledError("Failed to remove Collection from badge",e)})},t.prototype.updateBadge=function(e){this.badge=e.entityForSlug(this.badgeSlug),this.badges=e.entities,this.updateData()},t.prototype.updateData=function(){var e,t=this;this.title.setTitle("Backpack - "+this.badge.badgeClass.name+" - "+(this.configService.theme.serviceName||"Badgr")),this.badge.markAccepted(),this.issuerBadgeCount=1===(e=t.badges.filter(function(e){return e.issuerId===t.badge.issuerId}).length)?"1 Badge":e+" Badges"},t.prototype.clickLaunchpoint=function(e){var t=this;this.externalToolsManager.getLaunchInfo(e,this.badgeSlug).then(function(e){t.eventService.externalToolLaunch.next(e)})},t}(r.a));function l(e){return c({shareUrl:e.shareUrl,imageUrl:e.imagePreview,badgeClassName:e.badgeClass.name,badgeClassDescription:e.badgeClass.description,issueDate:e.issueDate,recipientName:e.getExtension("extensions:recipientProfile",{name:void 0}).name,recipientIdentifier:e.recipientEmail})}function c(e){return{title:"Share Badge",shareObjectType:"BadgeInstance",shareUrl:e.shareUrl,shareTitle:e.badgeClassName,imageUrl:e.imageUrl,shareIdUrl:e.shareUrl,shareSummary:e.badgeClassDescription,shareEndpoint:"certification",showRecipientOptions:!0,recipientIdentifier:e.recipientIdentifier,recipientType:e.recipientType,embedOptions:[{label:"Card",embedTitle:"Badge: "+e.badgeClassName,embedType:"iframe",embedSize:{width:330,height:186},embedVersion:1,embedUrl:e.shareUrl,embedLinkUrl:null},{label:"Badge",embedTitle:"Badge: "+e.badgeClassName,embedType:"image",embedSize:{width:128,height:128},embedVersion:1,embedUrl:e.imageUrl,embedLinkUrl:e.shareUrl,embedAwardDate:e.issueDate,embedBadgeName:e.badgeClassName,embedRecipientName:e.recipientName}]}}}}]);